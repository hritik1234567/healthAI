<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEAL AI</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="./frontendfiles/script1.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <img src="./images/logo.jpeg" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
            <a class="navbar-brand" href="/">HEAL AI</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#my-appointments" id="my-appointments-link">My Appointments</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="my-chatbot" onclick="openChatbot()">AI Chatbot</a>
                    </li>
                </ul>
            </div>
            <div class="navbar-button d-flex" id="auth-buttons">
                <!-- Login/Logout buttons will be injected here -->
            </div>
        </div>
    </nav>
    <!-- Body starts -->
    <div class="container">
        <div class="left-column">
            <!-- Add your content here -->
            <h2 class="text-white">The Future of Health</h2>
            <p class="text-white-50">Welcome to HEAL AI, your trusted health companion in the digital age. Discover
                personalized recommendations and find the perfect healthcare professional tailored to your unique needs.
                Let us guide you on your journey to optimal health and well-being.</p>
            <button type="button" class="btn btn-warning">Register Here</button>
        </div>
        <div class="right-column">
            <!-- Add person image and text here -->
            <img class="person-image person1" src="./images/modelbackground.jpeg" alt="Person Image">
            <img class="person-image person2" src="./images/model.jpeg" alt="Person Image">
        </div>
    </div>

    <!-- New section -->
    <div class="features-section">
        <div class="container">
            <h2 class="mb-4">OUR FEATURES</h2>
            <p class="mb-4">Utilize cutting-edge AI algorithms to provide advanced diagnostic capabilities,
                helping to identify potential health issues early and accurately.</p>
        </div>
        <div class="cards" id="features-cards">
            <div class="card" style="width: 18rem;">
                <img src="./images/card1.jpeg" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">Personalized Treatment Recommendations:</h5>
                    <p class="card-text text-body-emphasis">Receive personalized treatment recommendations based on your
                        unique health profile, ensuring that your care plan is tailored to your specific needs</p>
                </div>
            </div>
            <div class="card" style="width: 18rem;">
                <img src="./images/card2.jpeg" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">Real-Time Data Analysis</h5>
                    <p class="card-text text-body-emphasis">Analyze health data in real-time to provide immediate
                        feedback and insights, helping you stay proactive about your health.</p>
                </div>
            </div>
            <div class="card" style="width: 18rem;">
                <img src="./images/card3.jpeg" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">AI-Powered Symptom Checker</h5>
                    <p class="card-text text-body-emphasis">Use our AI-powered symptom checker to quickly assess your
                        symptoms and receive guidance on potential conditions and next steps</p>
                </div>
            </div>
        </div>
    </div>

    <!-- New section -->
    <div class="doctors-section">
        <div class="container">
            <h2 class="mb-4">OUR DOCTORS</h2>
            <div class="row justify-content-center mb-4">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search for doctors...">
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block" onclick="searchDoctors()">Search</button>
                </div>
            </div>
            <div class="row justify-content-evenly">
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block mb-3">General</button>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block mb-3">Dentist</button>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block mb-3">Heart</button>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block mb-3">Brain</button>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-warning btn-block mb-3">Allergy</button>
                </div>
            </div>
        </div>
        <div class="cards" id="doctor-cards">
            <!-- Doctor cards will be dynamically appended here -->
        </div>
    </div>

    <!-- Modal for Doctor Details -->
    <div class="modal fade" id="doctorDetailsModal" tabindex="-1" aria-labelledby="doctorDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="doctorDetailsModalLabel">Doctor Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="doctor-details">
                        <!-- Doctor details will be dynamically inserted here -->
                    </div>
                    <div class="mb-3">
                        <label for="appointmentDate" class="form-label">Select Appointment Date:</label>
                        <input type="date" id="appointmentDate" class="form-control">
                    </div>
        
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="confirmAppointmentButton">Confirm Appointment</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="appointmentsModal" tabindex="-1" aria-labelledby="appointmentsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="appointmentsModalLabel">My Appointments</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Doctor ID</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <!-- Appointments will be populated here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            
                <div class="col-md-3">
                    <h5>Products</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">AI Recommendation</a></li>
                        <li><a href="#">Appointment Scheduler</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Company Information</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Career</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="col-md-3">
                    <h5>Information</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Help</a></li>
                        <li><a href="#">Community Forum</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Location</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Jss Academy of Technical Education</a></li>
                        <li><a href="#">Sector-62,Noida</a></li>
                        
                    </ul>
                    <div class="mapouter"><div class="gmap_canvas"><iframe width="300" height="300" id="gmap_canvas" src="https://maps.google.com/maps?q=Jss+Academy+of+Technical+Education&t=&z=13&ie=UTF8&iwloc=&output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe><a href="https://online.stopwatch-timer.net/">timer for kids</a><br><a href="https://textcaseconvert.com/"></a><br><style>.mapouter{position: relative;text-align: right;height: 300px;width: 300px;}</style><a href="https://www.mapembed.net">map box</a><style>.gmap_canvas{overflow: hidden;background: none !important;height: 300px;width: 300px;}</style></div></div>
                </div>
           
        </div>
    </footer>
    <script src="script1.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
        
   <!-- <script>
       function openChatbot() {
    const sessionData = JSON.parse(localStorage.getItem('sessionData'));
    if (!sessionData) {
        sessioncreation();
    }
    window.open("chatbot.html", "_blank", "width=800,height=600");
}

async function sessioncreation() {
    try {
        const response = await fetch('https://maxbot-9ays.onrender.com/create_chat', {
            method: 'POST',
        });
        if (!response.ok) {
            throw new Error('Failed to get session id');
        }
        const responseData = await response.json();
        const sessionData = responseData[0];
        // Convert the responseData to a JSON string and store it in localStorage
        localStorage.setItem("sessionData", JSON.stringify(sessionData));

    } catch (error) {
        console.error('Error getting session_id:', error);
        alert('Error in getting session. Please try again.');
    }
}

// displaying the my-appointment none
document.addEventListener('DOMContentLoaded', () => {
            const appointmentsLink = document.getElementById('my-appointments-link');
            const chatbotlink = document.getElementById('my-chatbot');
            const user = JSON.parse(localStorage.getItem('user'));
            const token = localStorage.getItem('token');

            if (!user || !token) {
                appointmentsLink.style.display = 'none';
                chatbotlink.style.display='none';
            }
        });
        // Fetch appointment  data from backend
        document.querySelector('.nav-link[href="#my-appointments"]').addEventListener('click', async () => {
    try {
        // Get patient_id from local storage
        const patient = JSON.parse(localStorage.getItem('user'));
        const patientId=patient._id;
        console.log(patientId);
        if (!patientId) {
            alert('Patient ID is not available in local storage.');
            return;
        }

        // Make POST request to fetch appointments
        const response = await fetch('http://localhost:8000/api/appointment/myappointment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({patient_id: patient._id }),
        });

        if (!response.ok) {
            throw new Error('Failed to fetch appointments');
        }

        const appointments = await response.json();
        if (!appointments.length) {
                    alert('No appointments are booked till now');
                    return;
                }
        const appointmentsTableBody = document.getElementById('appointmentsTableBody');
        appointmentsTableBody.innerHTML = ''; // Clear existing data

        // Populate table with fetched appointments
        appointments.forEach(appointment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${appointment.doctor_id}</td>
                
                <td>${appointment.appointmentTime}</td>
                
            `;
            appointmentsTableBody.appendChild(row);
        });

        // Show the modal
        const appointmentsModal = new bootstrap.Modal(document.getElementById('appointmentsModal'));
        appointmentsModal.show();
    } catch (error) {
        console.error('Error fetching appointments:', error);
        alert('An error occurred while fetching appointments. Please try again later.');
    }
});

     
        // Fetch doctor data from backend with optional search query
async function fetchDoctorData(searchQuery = '') {
    try {
        const response = await fetch(`http://localhost:8000/api/doctors?search=${searchQuery}`);
        if (!response.ok) {
            throw new Error('Failed to fetch data');
        }
        return await response.json();
    } catch (error) {
        console.error('Error fetching data:', error);
        return [];
    }
}
async function postAppointment(appointmentData) {
            const confirmAppointmentButton = document.getElementById('confirmAppointmentButton');

            try {
                confirmAppointmentButton.disabled = true;
                const response = await fetch('http://localhost:8000/api/appointment/booking', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(appointmentData)
                });
                if (!response.ok) {
                    throw new Error('Failed to book appointment');
                }
                const responseData = await response.json();
                const message=responseData.message;
                alert(message);
                confirmAppointmentButton.disabled = false;
                const doctorDetailsModal = bootstrap.Modal.getInstance(document.getElementById('doctorDetailsModal'));
                doctorDetailsModal.hide();
            } catch (error) {
                console.error('Error booking appointment:', error);
                alert('Error booking appointment. Please try again.');
            }
        }

        // Handle confirm appointment button click
        document.getElementById('confirmAppointmentButton').addEventListener('click', async () => {
            const doctorId = document.getElementById('doctorId').textContent;
            const appointmentDate = document.getElementById('appointmentDate').value;
            const patient = JSON.parse(localStorage.getItem('user'));
        
            if (!doctorId || !appointmentDate || !patient) {
                alert('Missing appointment details. Please try again.');
                return;
            }

            const appointmentData = {
                doctor_id: doctorId,
                patient_id: patient._id,
                //patientContact: patient.phoneNumber,
                appointmentTime:appointmentDate
            };

            await postAppointment(appointmentData);
        });



// Dynamically create doctor cards
async function createDoctorCards(searchQuery = '') {
    const doctorData = await fetchDoctorData(searchQuery);
    const doctorCardsContainer = document.getElementById('doctor-cards');
    doctorCardsContainer.innerHTML = ''; // Clear previous cards

    doctorData.slice(0, 4).forEach((doctor, index) => {
        const card = `
            <div class="card" style="width: 18rem;">
                <img src="./images/doctor${index + 1}.jpeg" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">${doctor.Name}</h5>
                    <h5 class="card-text">${doctor.Speciality}</h5>
                    <h6 class="card-text">${doctor.Location}</h6>
                    <button class="btn btn-warning" onclick="showDoctorDetails(${doctor.doctor_id})">Book Appointment</button>
                </div>
            </div>
        `;
        doctorCardsContainer.insertAdjacentHTML('beforeend', card);
    });
}

// Handle doctor search
function searchDoctors() {
    const searchQuery = document.getElementById('searchInput').value.trim();
    createDoctorCards(searchQuery);
}

// Fetch doctor details by ID from backend
async function fetchDoctorDetails(doctor_id) {
    try {
        const response = await fetch(`http://localhost:8000/api/doctors/${doctor_id}`);
        if (!response.ok) {
            throw new Error('Failed to fetch data');
        }
        return await response.json();
    } catch (error) {
        console.error('Error fetching data:', error);
        return null;
    }
}

// Show doctor details in a modal
async function showDoctorDetails(doctorId) {
    const doctorDetails = await fetchDoctorDetails(doctorId);
    if (doctorDetails) {
        const doctorDetailsContainer = document.getElementById('doctor-details');
        doctorDetailsContainer.innerHTML = `
            <p><strong>Name:</strong> ${doctorDetails.Name}</p>
            <p><strong>Specialization:</strong> ${doctorDetails.Speciality}</p>
            <p><strong>Location:</strong> ${doctorDetails.Location} </p>
            <p><strong>Contact:</strong> ${doctorDetails.PhoneNumber}</p>
            <p id="doctorId" style="display:none"> ${doctorDetails.doctor_id}</p>
        `;
        const appointmentDateInput = document.getElementById('appointmentDate');
        const today = new Date();
        const maxDate = new Date(today.getTime() + (7 * 24 * 60 * 60 * 1000)); // Next 7 days
        appointmentDateInput.min = today.toISOString().split('T')[0]; // Set min date to today
        appointmentDateInput.max = maxDate.toISOString().split('T')[0];

        const doctorDetailsModal = new bootstrap.Modal(document.getElementById('doctorDetailsModal'));
        doctorDetailsModal.show();
    }
}

// Check session on page load and update navbar
async function checkSession() {
    const token = localStorage.getItem('token');
    const user = localStorage.getItem('user');

    const authButtons = document.getElementById('auth-buttons');

    if (token && user) {
        const userData = JSON.parse(user);
        authButtons.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="bi bi-person-fill" style="color: yellow;">${userData.name}</i>
                <button type="button" class="btn btn-warning ms-2" onclick="logout()">Logout</button>
            </div>
        `;
    } else {
        authButtons.innerHTML = `
            <button type="button" class="btn btn-warning me-2" onclick="window.location.href='login.html'">Login</button>
            <button type="button" class="btn btn-warning" onclick="window.location.href='signup.html'">Sign up</button>
        `;
    }
}

async function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    localStorage.removeItem('sessionData');
    window.location.href = 'login.html';
}

window.onload = function() {
    checkSession();
    createDoctorCards();
};

    </script>-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
